-- LocalScript

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerName = player.Name

------------------------------------------------------------
-- HELPERS (UNCHANGED LOGIC)
------------------------------------------------------------
local function findPlayerModel()
	local killers = workspace:FindFirstChild("Killers")
	if killers then
		local m = killers:FindFirstChild(playerName)
		if m then return m end
	end

	local survivors = workspace:FindFirstChild("Survivors")
	if survivors then
		local m = survivors:FindFirstChild(playerName)
		if m then return m end
	end

	return nil
end

local function getSprintStuffChild(childName, className)
	local model = findPlayerModel()
	if not model then return nil end

	local sprintStuff = model:FindFirstChild("SprintStuff")
	if not sprintStuff then return nil end

	local obj = sprintStuff:FindFirstChild(childName)
	if not obj then return nil end

	if className and not obj:IsA(className) then return nil end
	return obj
end

------------------------------------------------------------
-- RAYFIELD UI
------------------------------------------------------------
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

local Window = Rayfield:CreateWindow({
	Name = "LoL script",
	LoadingTitle = "Blah blah blah",
	LoadingSubtitle = "hihihihihihhihihihihihihi",
	ConfigurationSaving = { Enabled = false }
})

local Tab = Window:CreateTab("Main", 0)

------------------------------------------------------------
-- TOGGLE: AUTO DOUBLEREGEN
------------------------------------------------------------
local autoDoubleRegen = false

Tab:CreateToggle({
	Name = "Auto DoubleRegen",
	CurrentValue = false,
	Callback = function(value)
		autoDoubleRegen = value
	end,
})

------------------------------------------------------------
-- TEXTBOX: MAX STAMINA CHANGER
------------------------------------------------------------
local maxStaminaValue = nil

Tab:CreateInput({
	Name = "MaxStamina changer",
	PlaceholderText = "Enter number...",
	RemoveTextAfterFocusLost = false,
	Callback = function(text)
		local val = tonumber(text)
		if not val then return end
		maxStaminaValue = val

		local maxStamina = getSprintStuffChild("MaxStamina")
		if maxStamina and (maxStamina:IsA("NumberValue") or maxStamina:IsA("IntValue")) then
			maxStamina.Value = val
		end
	end,
})

------------------------------------------------------------
-- TOGGLE: ANTI STAMINA REGEN PAUSE
------------------------------------------------------------
local antiPauseEnabled = false

Tab:CreateToggle({
	Name = "anti stamina regen pause",
	CurrentValue = false,
	Callback = function(value)
		antiPauseEnabled = value
	end,
})

------------------------------------------------------------
-- HEARTBEAT ENFORCEMENT (UNCHANGED)
------------------------------------------------------------
RunService.Heartbeat:Connect(function()
	-- Auto DoubleRegen
	if autoDoubleRegen then
		local dr = getSprintStuffChild("DoubleRegen", "BoolValue")
		if dr and dr.Value == false then
			dr.Value = true
		end
	end

	-- Anti stamina regen pause
	if antiPauseEnabled then
		local disabled = getSprintStuffChild("DisabledStamina", "BoolValue")
		if disabled and disabled.Value == true then
			disabled.Value = false
		end

		local regen = getSprintStuffChild("RegenStamina", "BoolValue")
		if regen and regen.Value == false then
			regen.Value = true
		end
	end
end)

-- state variable
local lockMaxStamina = false

-- toggle
Tab:CreateToggle({
	Name = "Auto set MaxStamina",
	CurrentValue = false,
	Callback = function(value)
		lockMaxStamina = value
	end,
})

-- enforcement loop (add once if you don't already have one)
RunService.Heartbeat:Connect(function()
	if not lockMaxStamina then return end
	if not maxStaminaValue then return end

	local maxStamina = getSprintStuffChild("MaxStamina")
	if maxStamina and (maxStamina:IsA("NumberValue") or maxStamina:IsA("IntValue")) then
		if maxStamina.Value ~= maxStaminaValue then
			maxStamina.Value = maxStaminaValue
		end
	end
end)

local antiNoRun = false

-- Toggle
Tab:CreateToggle({
	Name = "anti no run when aiming rocket",
	CurrentValue = false,
	Flag = "AntiNoRunRocket",
	Callback = function(Value)
		antiNoRun = Value
	end,
})

-- Enforcement loop
RunService.Heartbeat:Connect(function()
	if not antiNoRun then return end

	local survivors = workspace:FindFirstChild("Survivors")
	if not survivors then return end

	local model = survivors:FindFirstChild(LocalPlayer.Name)
	if not model then return end

	local sprintStuff = model:FindFirstChild("SprintStuff")
	if not sprintStuff then return end

	local noRun = sprintStuff:FindFirstChild("NoRun")
	if noRun and noRun:IsA("BoolValue") and noRun.Value == true then
		noRun.Value = false
	end
end)

-- ===== HP ESP ONLY (HUMANOID HEALTH) =====

local hpESPEnabled = false
local hpEspCache = {}

local function getPlayerTeam(plr)
	if workspace:FindFirstChild("Killers") and workspace.Killers:FindFirstChild(plr.Name) then
		return "Killer"
	end
	if workspace:FindFirstChild("Survivors") and workspace.Survivors:FindFirstChild(plr.Name) then
		return "Survivor"
	end
	return nil
end

local function removeHpESP(plr)
	if hpEspCache[plr] then
		hpEspCache[plr]:Destroy()
		hpEspCache[plr] = nil
	end
end

local function createHpESP(plr)
	if not hpESPEnabled then return end
	if plr == LocalPlayer then return end
	if not plr.Character then return end

	local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
	local hum = plr.Character:FindFirstChildOfClass("Humanoid")
	if not hrp or not hum then return end

	local team = getPlayerTeam(plr)
	if not team then return end

	removeHpESP(plr)

	local billboard = Instance.new("BillboardGui")
	billboard.Name = "HpESP"
	billboard.Adornee = hrp
	billboard.Size = UDim2.new(0, 200, 0, 40)
	billboard.StudsOffset = Vector3.new(0, 3, 0)
	billboard.AlwaysOnTop = true

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, 0, 1, 0)
	label.BackgroundTransparency = 1
	label.TextStrokeTransparency = 0
	label.TextScaled = true
	label.Font = Enum.Font.SourceSansBold

	label.TextColor3 = team == "Killer"
		and Color3.fromRGB(255, 60, 60)
		or Color3.fromRGB(60, 255, 60)

	label.Text = "HP: " .. math.floor(hum.Health)
	label.Parent = billboard

	billboard.Parent = game.CoreGui
	hpEspCache[plr] = billboard
end

local function refreshHpESP()
	for _, plr in ipairs(Players:GetPlayers()) do
		createHpESP(plr)
	end
end

RunService.Heartbeat:Connect(function()
	if not hpESPEnabled then return end
	for plr, gui in pairs(hpEspCache) do
		local hum = plr.Character and plr.Character:FindFirstChildOfClass("Humanoid")
		local label = gui and gui:FindFirstChildOfClass("TextLabel")
		if hum and label then
			label.Text = "HP: " .. math.floor(hum.Health)
		end
	end
end)

task.spawn(function()
	while true do
		if hpESPEnabled then
			refreshHpESP()
		end
		task.wait(1)
	end
end)

Tab:CreateToggle({
	Name = "HP ESP",
	CurrentValue = false,
	Flag = "hp_esp",
	Callback = function(Value)
		hpESPEnabled = Value
		if Value then
			refreshHpESP()
		else
			for _, gui in pairs(hpEspCache) do
				if gui then gui:Destroy() end
			end
			table.clear(hpEspCache)
		end
	end
})

-- ===== HIGHLIGHT ESP =====

local espEnabled = false
local espCache = {}

local function removeESP(plr)
	if espCache[plr] then
		espCache[plr]:Destroy()
		espCache[plr] = nil
	end
end

local function getPlayerTeam(plr)
	if workspace:FindFirstChild("Killers") and workspace.Killers:FindFirstChild(plr.Name) then
		return "Killer"
	end
	if workspace:FindFirstChild("Survivors") and workspace.Survivors:FindFirstChild(plr.Name) then
		return "Survivor"
	end
	return nil
end

local function applyESPToPlayer(plr)
	if not espEnabled then return end
	if plr == LocalPlayer then return end
	if not plr.Character then return end

	removeESP(plr)

	local team = getPlayerTeam(plr)
	if not team then return end

	local hl = Instance.new("Highlight")
	hl.Adornee = plr.Character
	hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	hl.FillTransparency = 0.35
	hl.OutlineTransparency = 0

	if team == "Killer" then
		hl.FillColor = Color3.fromRGB(255, 60, 60)
		hl.OutlineColor = Color3.fromRGB(255, 0, 0)
	else
		hl.FillColor = Color3.fromRGB(60, 255, 60)
		hl.OutlineColor = Color3.fromRGB(0, 255, 0)
	end

	hl.Parent = game.CoreGui
	espCache[plr] = hl
end

local function refreshESP()
	for _, plr in ipairs(Players:GetPlayers()) do
		applyESPToPlayer(plr)
	end
end

local function clearESP()
	for _, hl in pairs(espCache) do
		if hl then hl:Destroy() end
	end
	table.clear(espCache)
end

task.spawn(function()
	while true do
		if espEnabled then
			refreshESP()
		end
		task.wait(1)
	end
end)

Tab:CreateToggle({
	Name = "ESP",
	CurrentValue = false,
	Flag = "esp",
	Callback = function(Value)
		espEnabled = Value
		if Value then
			refreshESP()
		else
			clearESP()
		end
	end
})

local Section = Tab:CreateSection("Ability decks")

local Button = Tab:CreateButton({
   Name = "Gunslinger",
   Callback = function()
   local args = {
    1,
    "Punch",
    "Revolver"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Punch",
    "Revolver",
    "rbxassetid://73130054435684",
    "rbxassetid://121722959097329"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})

local Button = Tab:CreateButton({
   Name = "LiveDroid's worst nightmare",
   Callback = function()
   local args = {
    1,
    "Block",
    "Revolver"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Block",
    "Revolver",
    "rbxassetid://114764935401015",
    "rbxassetid://121722959097329"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})

local Button = Tab:CreateButton({
   Name = "The Taunter",
   Callback = function()
   local args = {
    1,
    "Punch",
    "Taunt"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Punch",
    "Taunt",
    "rbxassetid://73130054435684",
    "rbxassetid://122433943011026"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})

local Section = Tab:CreateSection("Synergies")

local Button = Tab:CreateButton({
   Name = "ChezBurger man",
   Callback = function()
   local args = {
    1,
    "Chezburger",
    "Chezburger"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Chezburger",
    "Chezburger",
    "rbxassetid://11125881651",
    "rbxassetid://11125881651"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})

local Button = Tab:CreateButton({
   Name = "LoveShot",
   Callback = function()
   local args = {
    1,
    "Revolver",
    "Coiltaker"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Revolver",
    "Coiltaker",
    "rbxassetid://11125881651",
    "rbxassetid://79847866387639"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})

local Button = Tab:CreateButton({
   Name = "CarePad",
   Callback = function()
   local args = {
    1,
    "Coiltaker",
    "BonusPad"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Coiltaker",
    "BonusPad",
    "rbxassetid://11125881651",
    "rbxassetid://109145887371111"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})

local Button = Tab:CreateButton({
   Name = "Prankster",
   Callback = function()
   local args = {
    1,
    "Water Balloon",
    "Taunt"
}
game:GetService("ReplicatedStorage"):WaitForChild("SurvActions"):FireServer(unpack(args))
local args = {
    7,
    true,
    "Water Balloon",
    "Taunt",
    "rbxassetid://11125881651",
    "rbxassetid://122433943011026"
}
game:GetService("ReplicatedStorage"):WaitForChild("PlayerActions"):FireServer(unpack(args))
   end,
})
